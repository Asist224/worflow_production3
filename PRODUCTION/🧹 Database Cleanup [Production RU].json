{
  "name": "ğŸ§¹ Database Cleanup [Production RU]",
  "nodes": [
    {
      "parameters": {
        "content": "## ğŸ§¹ Database Cleanup\n\n### ğŸ“‹ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ\nĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….\n\n**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**\n- ĞĞ²Ñ‚Ğ¾Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ (ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ Ğ² 3:00)\n- API Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº\n- API Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº\n\n---\n\n### âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° CONFIG\n\n| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |\n|----------|----------|\n| `api_key` | API ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ |\n| `rate_limit_window_ms` | ĞĞºĞ½Ğ¾ rate limiting (Ğ¼Ñ) |\n| `rate_limit_max_requests` | ĞœĞ°ĞºÑ. Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¾ĞºĞ½Ğµ |\n| `table_webchat_monitoring` | Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° |\n| `table_dialog_analysis` | Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° |\n| `table_chat_histories_ru` | Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ° RU |\n| `table_chat_histories_en` | Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ° EN |\n| `table_user_contact_data` | ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ |\n| `table_cleanup_settings` | ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ |\n| `table_cleanup_logs` | Ğ›Ğ¾Ğ³Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ |\n\n---\n\n### ğŸ“¥ API Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹\n\n**ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:**\n```\nGET /webhook/cleanup-settings?apiKey=YOUR_KEY\n```\n\n**ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:**\n```json\nPOST /webhook/update-cleanup-settings?apiKey=YOUR_KEY\n{\n  \"monitoringRetention\": 30,\n  \"analysisRetention\": 90,\n  \"dialogsRetention\": 60,\n  \"contactsRetention\": 180\n}\n```",
        "height": 952,
        "width": 596,
        "color": 5
      },
      "id": "0c236693-9d4b-47ef-a614-0ef6b825fa64",
      "name": "ğŸ“ Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -10560,
        -1520
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "api-key",
              "name": "api_key",
              "value": "YOUR_API_KEY_HERE",
              "type": "string"
            },
            {
              "id": "rate-window",
              "name": "rate_limit_window_ms",
              "value": 60000,
              "type": "number"
            },
            {
              "id": "rate-max",
              "name": "rate_limit_max_requests",
              "value": 60,
              "type": "number"
            },
            {
              "id": "table-monitoring",
              "name": "table_webchat_monitoring",
              "value": "webchat_monitoring",
              "type": "string"
            },
            {
              "id": "table-analysis",
              "name": "table_dialog_analysis",
              "value": "dialog_analysis",
              "type": "string"
            },
            {
              "id": "table-chat-ru",
              "name": "table_chat_histories_ru",
              "value": "n8n_chat_histories_ru",
              "type": "string"
            },
            {
              "id": "table-chat-en",
              "name": "table_chat_histories_en",
              "value": "n8n_chat_histories_en",
              "type": "string"
            },
            {
              "id": "table-contacts",
              "name": "table_user_contact_data",
              "value": "user_contact_data",
              "type": "string"
            },
            {
              "id": "table-settings",
              "name": "table_cleanup_settings",
              "value": "cleanup_settings",
              "type": "string"
            },
            {
              "id": "table-logs",
              "name": "table_cleanup_logs",
              "value": "cleanup_logs",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "41f1876d-08eb-45b0-b1b2-b4088fcfaa99",
      "name": "âš™ï¸ CONFIG: Cleanup",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -9728,
        -1456
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "api-key",
              "name": "api_key",
              "value": "24fs-$r4d-defd-77ds-7eds",
              "type": "string"
            },
            {
              "id": "rate-window",
              "name": "rate_limit_window_ms",
              "value": 60000,
              "type": "number"
            },
            {
              "id": "rate-max",
              "name": "rate_limit_max_requests",
              "value": 60,
              "type": "number"
            },
            {
              "id": "table-settings",
              "name": "table_cleanup_settings",
              "value": "cleanup_settings",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "c6a12ad2-3d1d-4dfa-bea6-d2768d1b0f9c",
      "name": "âš™ï¸ CONFIG: Get Settings",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -9744,
        -1088
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "api-key",
              "name": "api_key",
              "value": "24fs-$r4d-defd-77ds-7eds",
              "type": "string"
            },
            {
              "id": "rate-window",
              "name": "rate_limit_window_ms",
              "value": 60000,
              "type": "number"
            },
            {
              "id": "rate-max",
              "name": "rate_limit_max_requests",
              "value": 60,
              "type": "number"
            },
            {
              "id": "table-settings",
              "name": "table_cleanup_settings",
              "value": "cleanup_settings",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "058d3183-28e0-443f-9f9f-a0edae947127",
      "name": "âš™ï¸ CONFIG: Update Settings",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -9760,
        -752
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 3 * * *"
            }
          ]
        }
      },
      "id": "c64d6048-7db3-48d8-90cd-9b942fbb7672",
      "name": "â° Daily Cleanup 3 AM",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -9920,
        -1456
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ“Š ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¾Ğ¹\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWITH settings AS (\n    SELECT * FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_cleanup_settings }} LIMIT 1\n),\nsessions_to_delete_ru AS (\n    SELECT session_id FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_ru }}\n    GROUP BY session_id HAVING MAX(created_at) < NOW() - ((SELECT COALESCE(dialogs_retention_days, 60) FROM settings) || ' days')::INTERVAL\n),\nsessions_to_delete_en AS (\n    SELECT session_id FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_en }}\n    GROUP BY session_id HAVING MAX(created_at) < NOW() - ((SELECT COALESCE(dialogs_retention_days, 60) FROM settings) || ' days')::INTERVAL\n),\nmonitoring_sessions_to_delete AS (\n    SELECT session_id FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_webchat_monitoring }}\n    GROUP BY session_id HAVING MAX(last_activity_time) < NOW() - ((SELECT COALESCE(monitoring_retention_days, 30) FROM settings) || ' days')::INTERVAL\n)\nSELECT 'webchat_monitoring' as table_name,\n    (SELECT COUNT(*) FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_webchat_monitoring }}) as total_records,\n    (SELECT COUNT(*) FROM monitoring_sessions_to_delete) as records_to_delete\nUNION ALL\nSELECT 'dialog_analysis' as table_name,\n    (SELECT COUNT(*) FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_dialog_analysis }}) as total_records,\n    (SELECT COUNT(*) FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_dialog_analysis }} WHERE created_at < NOW() - ((SELECT COALESCE(analysis_retention_days, 90) FROM settings) || ' days')::INTERVAL) as records_to_delete\nUNION ALL\nSELECT 'n8n_chat_histories_ru' as table_name,\n    (SELECT COUNT(DISTINCT session_id) FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_ru }}) as total_records,\n    (SELECT COUNT(*) FROM sessions_to_delete_ru) as records_to_delete\nUNION ALL\nSELECT 'n8n_chat_histories_en' as table_name,\n    (SELECT COUNT(DISTINCT session_id) FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_en }}) as total_records,\n    (SELECT COUNT(*) FROM sessions_to_delete_en) as records_to_delete\nUNION ALL\nSELECT 'user_contact_data' as table_name,\n    (SELECT COUNT(*) FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_user_contact_data }}) as total_records,\n    (SELECT COUNT(*) FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_user_contact_data }} WHERE last_updated < NOW() - ((SELECT COALESCE(contacts_retention_days, 180) FROM settings) || ' days')::INTERVAL) as records_to_delete;",
        "options": {}
      },
      "id": "2cee7f36-cfed-4ee4-a349-173eb5a6a065",
      "name": "ğŸ˜ Get Statistics",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -9536,
        -1456
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“Š ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst stats = items.map(item => item.json);\nlet totalToDelete = 0;\nstats.forEach(stat => { totalToDelete += parseInt(stat.records_to_delete); });\n\nreturn [{\n    json: {\n        stats: stats,\n        totalToDelete: totalToDelete,\n        timestamp: new Date().toISOString()\n    }\n}];"
      },
      "id": "d3175d7e-bf91-44b0-9359-f209aa3fd8b9",
      "name": "ğŸ“Š Log Statistics",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9360,
        -1456
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.totalToDelete }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              },
              "id": "condition-check"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "96c2c573-6b0c-4dc8-8c95-2998ed4ce3f2",
      "name": "â“ Check if Needed",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -9200,
        -1456
      ]
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// â­ï¸ ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nreturn [{\n    json: {\n        status: 'skipped',\n        message: 'No records to cleanup',\n        timestamp: new Date().toISOString()\n    }\n}];"
      },
      "id": "2e3203e6-efed-40be-aac8-2ee5d2940f88",
      "name": "â­ï¸ No Cleanup Needed",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8960,
        -1264
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_cleanup_settings }} LIMIT 1;",
        "options": {}
      },
      "id": "c01dfa7f-a2d1-4834-bdb0-601b492a6837",
      "name": "ğŸ˜ Get Settings (Cleanup)",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8960,
        -1472
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWITH deleted AS (\n    DELETE FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_webchat_monitoring }}\n    WHERE session_id IN (\n        SELECT DISTINCT session_id FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_webchat_monitoring }}\n        GROUP BY session_id HAVING MAX(last_activity_time) < NOW() - INTERVAL '{{ $json.monitoring_retention_days || 30 }} days'\n    )\n    RETURNING *\n)\nSELECT COUNT(*) as deleted_monitoring FROM deleted;",
        "options": {}
      },
      "id": "2a04a021-85db-4de4-82aa-4fa5dcdb7b28",
      "name": "ğŸ˜ Cleanup Monitoring",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8656,
        -1808
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWITH deleted AS (\n    DELETE FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_dialog_analysis }}\n    WHERE created_at < NOW() - INTERVAL '{{ $json.analysis_retention_days || 90 }} days'\n    RETURNING *\n)\nSELECT COUNT(*) as deleted_analysis FROM deleted;",
        "options": {}
      },
      "id": "15b5db28-1275-4160-b7bf-e28a18ec8a38",
      "name": "ğŸ˜ Cleanup Analysis",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8656,
        -1648
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² RU\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWITH deleted AS (\n    DELETE FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_ru }}\n    WHERE session_id IN (\n        SELECT DISTINCT session_id FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_ru }}\n        GROUP BY session_id HAVING MAX(created_at) < NOW() - INTERVAL '{{ $json.dialogs_retention_days || 60 }} days'\n    )\n    RETURNING *\n)\nSELECT COUNT(*) as deleted_dialogs_ru FROM deleted;",
        "options": {}
      },
      "id": "3238e3a0-429a-4ccb-8f1d-226b99fdef21",
      "name": "ğŸ˜ Cleanup Dialogs RU",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8656,
        -1472
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² EN\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWITH deleted AS (\n    DELETE FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_en }}\n    WHERE session_id IN (\n        SELECT DISTINCT session_id FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_chat_histories_en }}\n        GROUP BY session_id HAVING MAX(created_at) < NOW() - INTERVAL '{{ $json.dialogs_retention_days || 60 }} days'\n    )\n    RETURNING *\n)\nSELECT COUNT(*) as deleted_dialogs_en FROM deleted;",
        "options": {}
      },
      "id": "c2c7802d-b624-42dc-93ad-56743325571c",
      "name": "ğŸ˜ Cleanup Dialogs EN",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8656,
        -1312
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¾Ğ²\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWITH deleted AS (\n    DELETE FROM {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_user_contact_data }}\n    WHERE last_updated < NOW() - INTERVAL '{{ $json.contacts_retention_days || 180 }} days'\n    RETURNING *\n)\nSELECT COUNT(*) as deleted_contacts FROM deleted;",
        "options": {}
      },
      "id": "7ca8ac25-7e42-4c2b-a9c4-296995972467",
      "name": "ğŸ˜ Cleanup Contacts",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8656,
        -1168
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 5,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -8368,
        -1520
      ],
      "id": "d23e575f-77ba-474e-93e1-29bc6e5ef1f5",
      "name": "ğŸ”€ Merge Results"
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“Š ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst results = {\n  monitoring_deleted: 0,\n  analysis_deleted: 0,\n  dialogs_ru_deleted: 0,\n  dialogs_en_deleted: 0,\n  contacts_deleted: 0\n};\n\nconst allInputs = $input.all();\n\nfor (const item of allInputs) {\n  const data = item.json;\n  if ('deleted_monitoring' in data) { results.monitoring_deleted = parseInt(data.deleted_monitoring) || 0; }\n  if ('deleted_analysis' in data) { results.analysis_deleted = parseInt(data.deleted_analysis) || 0; }\n  if ('deleted_dialogs_ru' in data) { results.dialogs_ru_deleted = parseInt(data.deleted_dialogs_ru) || 0; }\n  if ('deleted_dialogs_en' in data) { results.dialogs_en_deleted = parseInt(data.deleted_dialogs_en) || 0; }\n  if ('deleted_contacts' in data) { results.contacts_deleted = parseInt(data.deleted_contacts) || 0; }\n}\n\nresults.total_deleted = results.monitoring_deleted + results.analysis_deleted + results.dialogs_ru_deleted + results.dialogs_en_deleted + results.contacts_deleted;\n\nreturn [{json: results}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8192,
        -1472
      ],
      "id": "888d4986-2440-4883-be0f-555cdc52110d",
      "name": "ğŸ“Š Aggregate Results"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ° Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nINSERT INTO {{ $('âš™ï¸ CONFIG: Cleanup').first().json.table_cleanup_logs }} (status, cleanup_date)\nVALUES ('completed', NOW())\nRETURNING *;",
        "options": {}
      },
      "id": "5a85bd13-4cf5-4262-9352-cae201c77c40",
      "name": "ğŸ˜ Save Cleanup Log",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8032,
        -1472
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "path": "cleanup-settings",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "d43f1b11-ec11-4acb-bbf8-178293192418",
      "name": "ğŸŒ Webhook: Get Settings",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -9936,
        -1088
      ],
      "webhookId": "cleanup-settings-webhook"
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: API KEY + RATE LIMITING\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst config = $('âš™ï¸ CONFIG: Get Settings').first().json;\nconst API_KEY = config.api_key;\nconst RATE_LIMIT_WINDOW_MS = config.rate_limit_window_ms;\nconst RATE_LIMIT_MAX_REQUESTS = config.rate_limit_max_requests;\n\nconst inputData = $('ğŸŒ Webhook: Get Settings').item.json;\nconst body = inputData.body || {};\nconst headers = inputData.headers || {};\nconst query = inputData.query || {};\nconst clientIP = headers['x-real-ip'] || headers['x-forwarded-for'] || headers['cf-connecting-ip'] || 'unknown';\nconst now = Date.now();\n\nconst staticData = $getWorkflowStaticData('global');\nif (!staticData.rateLimits) { staticData.rateLimits = {}; }\nfor (const ip in staticData.rateLimits) {\n  if (now - staticData.rateLimits[ip].firstRequest > RATE_LIMIT_WINDOW_MS) { delete staticData.rateLimits[ip]; }\n}\nif (!staticData.rateLimits[clientIP]) {\n  staticData.rateLimits[clientIP] = { count: 1, firstRequest: now };\n} else {\n  staticData.rateLimits[clientIP].count++;\n  if (staticData.rateLimits[clientIP].count > RATE_LIMIT_MAX_REQUESTS) {\n    return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Too many requests', details: `Limit: ${RATE_LIMIT_MAX_REQUESTS} requests per minute`, status: 429 } } }];\n  }\n}\n\nconst providedKey = headers['x-api-key'] || body.apiKey || query.apiKey || '';\nif (!providedKey) { return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'API key not provided', status: 401 } } }]; }\nif (providedKey !== API_KEY) { return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Invalid API key', status: 401 } } }]; }\n\nreturn [{ json: { ...inputData, authorized: true } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9568,
        -1088
      ],
      "id": "6834ed2f-a0c0-492f-9188-e9d94de07ae8",
      "name": "ğŸ” Security Check (Get)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "auth-condition",
              "leftValue": "={{ $json.authorized }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -9392,
        -1088
      ],
      "id": "e745e46a-afaa-4d16-961f-2d140be94802",
      "name": "â“ Auth Check (Get)"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM {{ $('âš™ï¸ CONFIG: Get Settings').first().json.table_cleanup_settings }} LIMIT 1;",
        "options": {}
      },
      "id": "0df3da9b-152f-45c4-a29e-507f5244fdf2",
      "name": "ğŸ˜ Get Settings",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -9200,
        -1136
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\"status\": \"success\", \"settings\": $json} }}",
        "options": {}
      },
      "id": "d1b2fec7-9527-4aba-868e-8b57173f0c2f",
      "name": "âœ… Respond Settings",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -8992,
        -1136
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.error }}",
        "options": {
          "responseCode": "={{ $json.error.status }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -9200,
        -992
      ],
      "id": "02775335-2cd0-4306-a5d2-209259ee3a45",
      "name": "âŒ Error Response (Get)"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "update-cleanup-settings",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -9936,
        -752
      ],
      "id": "70e2e7c6-aa1c-4029-887c-9fb2e2c619e5",
      "name": "ğŸŒ Webhook: Update Settings",
      "webhookId": "bb5d906f-0618-47dc-bb02-c5cff1bbf303"
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: API KEY + RATE LIMITING\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst config = $('âš™ï¸ CONFIG: Update Settings').first().json;\nconst API_KEY = config.api_key;\nconst RATE_LIMIT_WINDOW_MS = config.rate_limit_window_ms;\nconst RATE_LIMIT_MAX_REQUESTS = config.rate_limit_max_requests;\n\nconst inputData = $('ğŸŒ Webhook: Update Settings').item.json;\nconst body = inputData.body || {};\nconst headers = inputData.headers || {};\nconst query = inputData.query || {};\nconst clientIP = headers['x-real-ip'] || headers['x-forwarded-for'] || headers['cf-connecting-ip'] || 'unknown';\nconst now = Date.now();\n\nconst staticData = $getWorkflowStaticData('global');\nif (!staticData.rateLimits) { staticData.rateLimits = {}; }\nfor (const ip in staticData.rateLimits) {\n  if (now - staticData.rateLimits[ip].firstRequest > RATE_LIMIT_WINDOW_MS) { delete staticData.rateLimits[ip]; }\n}\nif (!staticData.rateLimits[clientIP]) {\n  staticData.rateLimits[clientIP] = { count: 1, firstRequest: now };\n} else {\n  staticData.rateLimits[clientIP].count++;\n  if (staticData.rateLimits[clientIP].count > RATE_LIMIT_MAX_REQUESTS) {\n    return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Too many requests', details: `Limit: ${RATE_LIMIT_MAX_REQUESTS} requests per minute`, status: 429 } } }];\n  }\n}\n\nconst providedKey = headers['x-api-key'] || body.apiKey || query.apiKey || '';\nif (!providedKey) { return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'API key not provided', status: 401 } } }]; }\nif (providedKey !== API_KEY) { return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Invalid API key', status: 401 } } }]; }\n\nreturn [{ json: { ...inputData, authorized: true } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9568,
        -752
      ],
      "id": "ee1f5100-595a-45a3-abfa-98af48039656",
      "name": "ğŸ” Security Check (Update)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "auth-condition",
              "leftValue": "={{ $json.authorized }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -9408,
        -752
      ],
      "id": "9990b1f8-0369-4dd2-a9a9-74ef381579a9",
      "name": "â“ Auth Check (Update)"
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“¥ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst data = items[0].json.body || items[0].json;\n\nreturn [{\n    json: {\n        monitoring_retention_days: data.monitoringRetention || 30,\n        analysis_retention_days: data.analysisRetention || 90,\n        dialogs_retention_days: data.dialogsRetention || 60,\n        contacts_retention_days: data.contactsRetention || 180\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9168,
        -816
      ],
      "id": "c0501eaa-592b-4381-b9f0-d77bac3e6697",
      "name": "ğŸ“¥ Process Update Data"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-- ğŸ’¾ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸\n-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nUPDATE {{ $('âš™ï¸ CONFIG: Update Settings').first().json.table_cleanup_settings }}\nSET monitoring_retention_days = {{ $json.monitoring_retention_days }},\n    analysis_retention_days = {{ $json.analysis_retention_days }},\n    dialogs_retention_days = {{ $json.dialogs_retention_days }},\n    contacts_retention_days = {{ $json.contacts_retention_days }},\n    updated_at = NOW()\nWHERE id = 1\nRETURNING *;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8960,
        -816
      ],
      "id": "4faa3713-0569-40ef-8ef3-1b7f3f6eb02b",
      "name": "ğŸ˜ Update Settings",
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\"status\": \"success\", \"message\": \"ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹\", \"data\": $json} }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -8736,
        -816
      ],
      "id": "4f4c04a8-46dd-4c67-8527-78869ba82ca7",
      "name": "âœ… Respond Update"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.error }}",
        "options": {
          "responseCode": "={{ $json.error.status }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -9168,
        -656
      ],
      "id": "6b3348f9-f5c1-472a-8cf9-14ae3d75e5cb",
      "name": "âŒ Error Response (Update)"
    }
  ],
  "pinData": {},
  "connections": {
    "â° Daily Cleanup 3 AM": {
      "main": [
        [
          {
            "node": "âš™ï¸ CONFIG: Cleanup",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš™ï¸ CONFIG: Cleanup": {
      "main": [
        [
          {
            "node": "ğŸ˜ Get Statistics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ˜ Get Statistics": {
      "main": [
        [
          {
            "node": "ğŸ“Š Log Statistics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Log Statistics": {
      "main": [
        [
          {
            "node": "â“ Check if Needed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â“ Check if Needed": {
      "main": [
        [
          {
            "node": "ğŸ˜ Get Settings (Cleanup)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "â­ï¸ No Cleanup Needed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ˜ Get Settings (Cleanup)": {
      "main": [
        [
          {
            "node": "ğŸ˜ Cleanup Monitoring",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ˜ Cleanup Analysis",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ˜ Cleanup Dialogs RU",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ˜ Cleanup Dialogs EN",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ˜ Cleanup Contacts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ˜ Cleanup Monitoring": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ˜ Cleanup Analysis": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge Results",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ˜ Cleanup Dialogs RU": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge Results",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "ğŸ˜ Cleanup Dialogs EN": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge Results",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "ğŸ˜ Cleanup Contacts": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge Results",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "ğŸ”€ Merge Results": {
      "main": [
        [
          {
            "node": "ğŸ“Š Aggregate Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Aggregate Results": {
      "main": [
        [
          {
            "node": "ğŸ˜ Save Cleanup Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒ Webhook: Get Settings": {
      "main": [
        [
          {
            "node": "âš™ï¸ CONFIG: Get Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš™ï¸ CONFIG: Get Settings": {
      "main": [
        [
          {
            "node": "ğŸ” Security Check (Get)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Security Check (Get)": {
      "main": [
        [
          {
            "node": "â“ Auth Check (Get)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â“ Auth Check (Get)": {
      "main": [
        [
          {
            "node": "ğŸ˜ Get Settings",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âŒ Error Response (Get)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ˜ Get Settings": {
      "main": [
        [
          {
            "node": "âœ… Respond Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒ Webhook: Update Settings": {
      "main": [
        [
          {
            "node": "âš™ï¸ CONFIG: Update Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš™ï¸ CONFIG: Update Settings": {
      "main": [
        [
          {
            "node": "ğŸ” Security Check (Update)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Security Check (Update)": {
      "main": [
        [
          {
            "node": "â“ Auth Check (Update)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â“ Auth Check (Update)": {
      "main": [
        [
          {
            "node": "ğŸ“¥ Process Update Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âŒ Error Response (Update)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ Process Update Data": {
      "main": [
        [
          {
            "node": "ğŸ˜ Update Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ˜ Update Settings": {
      "main": [
        [
          {
            "node": "âœ… Respond Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "7bc9a473-8de2-4ca2-a824-900a4f89a943",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9a2a948e1b1119e76dce477f4f08641c41898f344f4216cb90098437b1dcaf00"
  },
  "id": "kwbiltkxVdA5HWbR",
  "tags": []
}